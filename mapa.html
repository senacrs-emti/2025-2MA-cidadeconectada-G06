<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa - Agente Urbano</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="shortcut icon"
        href="https://images.vexels.com/media/users/3/136189/isolated/preview/8aff3574eabda894d8f7484bf8e81a6e-icone-de-casa-azul.png"
        type="image/x-icon">
</head>

<body class="map-page">

    <div vw class="enabled">
        <div vw-access-button class="active"></div>
        <div vw-plugin-wrapper>
            <div class="vw-plugin-top-wrapper"></div>
        </div>
    </div>
    <script src="https://vlibras.gov.br/app/vlibras-plugin.js"></script>
    <script>
        new window.VLibras.Widget('https://vlibras.gov.br/app');
    </script>

    <div class="header-nav" style="position: fixed; top: 0; width: 100%; z-index: 1000;">
        <div class="logo">
            <a href="index.html"><i class="fas fa-chart-line"></i> Agente Urbano</a>
        </div>
        <nav class="main-menu">
            <a href="dashboard.php" class=""><i id="desenho" class="fas fa-tachometer-alt"></i> Dashboard</a>
            <a href="mapa.html" class="active"><i class="fas fa-map"></i> Mapa</a>
            <a href="relatorios.html" class=""><i class="fas fa-list-alt"></i> Relatórios</a>
        </nav>
        <div class="user-actions" style="margin-right: 1vw;">
            <a href="mapa.html" id="novo-relatorio-btn" class="new-report-btn">+ Novo Problema</a>
            <div id="profile-btn" class="profile-button">
                <img id="user-avatar" src="https://www.gravatar.com/avatar/?d=mp" alt="Avatar" class="avatar">
                <span id="user-name-text" class="user-name">Entrar</span>
            </div>
        </div>
    </div>

    <div id="photon-search-container">
        <input type="text" id="photon-search" placeholder="Pesquisar local...">
        <ul id="photon-results"></ul>
    </div>

    <main class="map-container">
        <div id="map"></div>

        <div id="legend-container">
            <h4 style="margin-top: -7px; margin-bottom: 2px;">Categorias</h4>
            <div class="legend-item"><i class="fas fa-lightbulb" style="color:#FFC107; margin-right: 5px;"></i>
                Iluminação</div>
            <div class="legend-item"><i class="fas fa-road" style="color:#0056b3; margin-right: 5px;"></i> Asfalto</div>
            <div class="legend-item"><i class="fas fa-trash-alt" style="color:#28A745;margin-right: 5px;"></i> Limpeza
            </div>
            <div class="legend-item"><i class="fas fa-water" style="color:#DC3545;margin-right: 5px;"></i> Água/Esgoto
            </div>
            <div class="legend-item"><i class="fas fa-bus" style="color:#6A5ACD;margin-right: 5px;"></i> Transporte
            </div>
            <div class="legend-item"><i class="fas fa-map-marker-alt"
                    style="color:#6C757D; margin-right: 5px; margin-left: 3px;"></i> Outros</div>
        </div>

        <div id="map-mode-selector">
            <button id="mode-street-btn" class="map-mode-btn active-mode"><i class="fas fa-road"></i> Mapa</button>
            <button id="mode-sat-btn" class="map-mode-btn"><i class="fas fa-satellite"></i> Satélite</button>

            <button id="mode-streetview-btn" class="map-mode-btn" title="Ver Street View">
                <i class="fas fa-street-view"></i>
            </button>
            <button id="recenter-btn" class="map-mode-btn" title="Voltar para sua localização">
                <i class="fas fa-location-crosshairs"></i>
            </button>
            <button id="open-filter-btn" class="map-mode-btn" title="Filtros e Estatísticas">
                <i class="fas fa-filter"></i>
            </button>
        </div>
    </main>

    <div id="auth-modal" class="modal hidden">
        <div class="modal-content profile-modal">
            <span class="close-btn auth-close-btn">&times;</span>
            <h2 id="auth-title">Entrar</h2>

            <form id="auth-form" class="profile-form">
                <div class="profile-image-container" style="display: none; margin-bottom: 15px;">
                    <img id="profile-image" src="https://www.gravatar.com/avatar/?d=mp" alt="Profile"
                        style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover; margin-bottom: 10px;">
                    <div style="display: flex; gap: 10px; justify-content: center;">
                        <input type="file" id="profile-image-input" name="avatar" accept="image/*"
                            style="display: none;">
                        <button type="button" id="change-image-btn" style="margin-top: 0;">Escolher Arquivo</button>
                        <button type="button" id="take-photo-btn" style="margin-top: 0;">Tirar Foto</button>
                    </div>
                    <video id="profile-video" autoplay playsinline
                        style="display:none; width:100px; height:100px; border-radius:50%; object-fit:cover; margin-top:10px;"></video>
                    <button type="button" id="capture-photo-btn" style="display:none; margin-top:5px;">Capturar</button>
                </div>
                <div class="form-group">
                    <label for="auth-username">Usuário</label>
                    <input type="text" id="auth-username" name="username" required>
                </div>
                <div class="form-group">
                    <label for="auth-password">Senha</label>
                    <input type="password" id="auth-password" name="password" required>
                </div>
                <div class="form-buttons" style="margin-top:20px;">
                    <button type="submit" id="auth-submit" class="submit-btn">Entrar</button>
                    <button type="button" id="switch-to-register" class="cancel-btn">Registrar</button>
                </div>
            </form>
        </div>
    </div>

    <div id="report-modal" class="modal hidden">
        <div class="modal-content large-modal">
            <span class="close-btn report-close-btn">&times;</span>
            <h2>Reportar Problema</h2>

            <form id="report-form" enctype="multipart/form-data">

                <label for="titulo">Título do Problema *</label>
                <input type="text" id="titulo" name="titulo" placeholder="Ex: Buraco na rua principal" required>

                <label for="descricao">Descrição Detalhada *</label>
                <textarea id="descricao" name="descricao" rows="4" placeholder="Descreva o problema em detalhes..."
                    required></textarea>

                <div class="form-row three-columns">
                    <div class="form-group category-group">
                        <label for="tipo">Categoria</label>
                        <select id="tipo" name="categoria" required>
                            <option value="" disabled selected>Selecione uma categoria</option>
                            <option value="iluminacao">Iluminação Pública</option>
                            <option value="asfalto">Asfalto / Buraco na Rua</option>
                            <option value="limpeza">Limpeza / Lixo Acumulado</option>
                            <option value="agua-esgoto">Água / Esgoto</option>
                            <option value="transporte">Transporte Público</option>
                            <option value="outros">Outros</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="prioridade">Prioridade</label>
                        <select id="prioridade" name="prioridade">
                            <option value="baixa" selected>Baixa</option>
                            <option value="media">Média</option>
                            <option value="alta">Alta</option>
                            <option value="urgente">Urgente</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="status">Status da Situação</label>
                        <select id="status" name="status">
                            <option value="Pendente" selected>Pendente</option>
                            <option value="Em Análise">Em Análise</option>
                            <option value="Em Andamento">Em Andamento</option>
                            <option value="Resolvido">Resolvido</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="imagem_upload">Imagem (Opcional)</label>
                    <div class="form-row image-row">
                        <input type="file" id="imagem_upload" name="imagem_upload" accept="image/*"
                            style="display: none;">

                        <input type="text" id="file-name-display" placeholder="Nenhum arquivo selecionado" readonly>

                        <button type="button" class="secondary-btn" id="upload-btn-styled">
                            <i class="fas fa-upload"></i> Selecionar Arquivo
                        </button>
                    </div>
                </div>

                <label for="endereco">Localização</label>
                <div class="form-row location-row">
                    <input type="text" id="endereco" name="endereco" placeholder="Endereço aproximado" required
                        readonly>
                    <button type="button" id="select-on-map-btn" class="secondary-btn"><i
                            class="fas fa-map-marker-alt"></i> Selecionar no Mapa</button>
                </div>

                <input type="hidden" id="form-latitude" name="latitude">
                <input type="hidden" id="form-longitude" name="longitude">

                <div class="form-buttons">
                    <button type="button" id="cancel-report" class="cancel-btn">Cancelar</button>
                    <button type="submit" class="submit-btn create-report-btn">Criar Relatório</button>
                </div>

            </form>
        </div>
    </div>
    <div id="streetview-modal" class="modal hidden">
        <div class="modal-content large-modal" style="height: 80vh;">
            <span id="close-streetview-btn" class="close-btn">&times;</span>
            <h2>Google Street View</h2>
            <div id="streetview-pano" style="width:100%; height: calc(100% - 70px); background:#ccc;"></div>
        </div>
    </div>

    <!-- UI message modal (replaces alert()) -->
    <div id="ui-message-modal" class="modal hidden" aria-hidden="true">
        <div class="modal-content" style="max-width:520px;">
            <span class="close-btn ui-message-close">&times;</span>
            <h2 id="ui-message-title">Mensagem</h2>
            <div id="ui-message-body" style="margin-top:12px; color: #333;"></div>
            <div style="margin-top:18px; text-align:right;">
                <button class="secondary-btn ui-message-ok">OK</button>
            </div>
        </div>
    </div>

    <!-- Toast container for transient messages -->
    <div id="ui-toast-container" aria-live="polite" aria-atomic="true" style="position: fixed; top: 20px; right: 20px; z-index: 3500;"></div>
    <div id="filter-sidebar" class="sidebar">
        <div class="sidebar-header">
            <h3>Filtros & Estatísticas</h3>
            <button id="close-filter-btn" class="close-btn">&times;</button>
        </div>
        <div class="sidebar-content">
            <div class="filter-section">
                <i class="fas fa-filter"></i>
                <h4 style="display: inline-block; margin-left: 5px; font-weight: bold;">Filtros</h4>

                <label for="filter-category">Categoria:</label>
                <select id="filter-category" class="form-control">
                    <option value="all">Todas as categorias</option>
                    <option value="iluminacao">Iluminação Pública</option>
                    <option value="asfalto">Asfalto / Buraco na Rua</option>
                    <option value="limpeza">Limpeza / Lixo Acumulado</option>
                    <option value="agua-esgoto">Água / Esgoto</option>
                    <option value="transporte">Transporte Público</option>
                    <option value="outros">Outros</option>
                </select>

                <label for="filter-status">Status:</label>
                <select id="filter-status" class="form-control">
                    <option value="all">Todos os status</option>
                    <option value="Pendente">Pendente</option>
                    <option value="Em Análise">Em Análise</option>
                    <option value="Em Andamento">Em Andamento</option>
                    <option value="Resolvido">Resolvido</option>
                </select>

                <label for="filter-city">Cidade:</label>
                <select id="filter-city" class="form-control" disabled>
                    <option value="all">Todas as cidades</option>
                </select>

                <label for="filter-sort">Ordenar por:</label>
                <select id="filter-sort" class="form-control">
                    <option value="recente">Mais Recentes</option>
                    <option value="antigo">Mais Antigos</option>
                    <option value="id-desc">ID (Decrescente)</option>
                    <option value="id-asc">ID (Crescente)</option>
                </select>
            </div>

            <div class="filter-actions">
                <button id="apply-filter-btn" class="submit-btn" style="flex-grow: 1;">Aplicar</button>
                <button id="clear-filter-btn" class="cancel-btn" style="flex-grow: 1;">Limpar</button>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBiD3nnZJEotrEUGK949Aw1ReC_aKPuSEM&libraries=places,geometry&callback=initMap" async defer></script>
    <script src="script.js"></script>
</body>

</html>